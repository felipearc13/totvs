## COMPROVANTE MASTER

````
SELECT SZPACIENTE.PRONTUARIO + '.'
       + Substring(CONVERT(VARCHAR(10), SZATENDIMENTO.DATAENTRADA, 112), 1, 120)
       + '.'
       + CONVERT(VARCHAR, SZATENDIMENTO.CODATENDIMENTO, 103)       AS RECIBO,
       SZPACIENTE.NOMEPACIENTE                                     AS PACIENTE,
       SZPACIENTE.PRONTUARIO                                       AS PRONTUARIO,
       SZRESPPACIENTE.NOMERESPATEND                                AS RESPFIN,
       SZATIVIDADES.DESCATIVIDADE                                  AS PROCE_AG,
       (SELECT TOP 1SZPEDIDOATEND.IDMOV
        FROM   SZPEDIDOATEND
               INNER JOIN SZATENDIMENTO (NOLOCK)
                       ON SZPEDIDOATEND.SEQUENCIALCONTA = SZATENDIMENTO.SEQUENCIALCONTA
               INNER JOIN SZPACIENTE (NOLOCK)
                       ON SZATENDIMENTO.CODCOLIGADA = SZPACIENTE.CODCOLIGADA
                          AND SZATENDIMENTO.CODPACIENTE = SZPACIENTE.CODPACIENTE
               INNER JOIN SZAGENDAMENTO (NOLOCK)
                       ON SZPACIENTE.CODPACIENTE = SZAGENDAMENTO.CODCLIENTE
               INNER JOIN SZATIVIDADES (NOLOCK)
                       ON SZAGENDAMENTO.CODATIVIDADE = SZATIVIDADES.CODATIVIDADE
               INNER JOIN SZRESPPACIENTE (NOLOCK)
                       ON SZATENDIMENTO.CODCOLIGADA = SZRESPPACIENTE.CODCOLIGADA
                          AND SZATENDIMENTO.CODPACIENTE = SZRESPPACIENTE.CODPACIENTE
                          AND SZATENDIMENTO.CODATENDIMENTO = SZRESPPACIENTE.CODATENDIMENTO
               INNER JOIN SZATENDEXTCOMPL (NOLOCK)
                       ON SZATENDIMENTO.CODCOLIGADA = SZATENDEXTCOMPL.CODCOLIGADA
                          AND SZATENDIMENTO.CODPACIENTE = SZATENDEXTCOMPL.CODPACIENTE
                          AND SZATENDIMENTO.CODATENDIMENTO = SZATENDEXTCOMPL.CODATENDIMENTO
        WHERE  CODIGOATENDIMENTO = SZATENDIMENTO.CODATENDIMENTO
               AND SZATENDIMENTO.DATAENTRADA = SZAGENDAMENTO.DATA
               AND SZATENDIMENTO.CODCOLIGADA = :CODCOLIGADA
               AND SZATENDIMENTO.CODPACIENTE = :CODPACIENTE
               AND SZATENDIMENTO.CODATENDIMENTO = :CODATENDIMENTO) AS IDMOV,
       (SELECT TOP 1 SZCADGERAL.RAZAOSOCIAL
        FROM   SZATENDIMENTO (NOLOCK)
               INNER JOIN SZPACIENTE (NOLOCK)
                       ON SZATENDIMENTO.CODCOLIGADA = SZPACIENTE.CODCOLIGADA
                          AND SZATENDIMENTO.CODPACIENTE = SZPACIENTE.CODPACIENTE
               INNER JOIN SZATENDHONORARIO (NOLOCK)
                       ON SZATENDIMENTO.NUMEROCONTA = SZATENDHONORARIO.NUMEROCONTA
                          AND SZATENDIMENTO.SEQUENCIALCONTA = SZATENDHONORARIO.SEQUENCIALCONTA
               INNER JOIN SZCADGERAL
                       ON SZCADGERAL.CODGERAL = SZATENDHONORARIO.CODPRESTADOR
        WHERE  SZATENDHONORARIO.ESTORNADO IS NULL
               AND SZATENDIMENTO.CODCOLIGADA = :CODCOLIGADA
               AND SZATENDIMENTO.CODPACIENTE = :CODPACIENTE
               AND SZATENDIMENTO.CODATENDIMENTO = :CODATENDIMENTO) AS MEDICO
FROM   SZATENDIMENTO (NOLOCK)
       INNER JOIN SZPACIENTE (NOLOCK)
               ON SZATENDIMENTO.CODCOLIGADA = SZPACIENTE.CODCOLIGADA
                  AND SZATENDIMENTO.CODPACIENTE = SZPACIENTE.CODPACIENTE
       INNER JOIN SZAGENDAMENTO (NOLOCK)
               ON SZPACIENTE.CODPACIENTE = SZAGENDAMENTO.CODCLIENTE
       INNER JOIN SZATIVIDADES
               ON SZATIVIDADES.CODATIVIDADE = SZAGENDAMENTO.CODATIVIDADE
       INNER JOIN SZRESPPACIENTE (NOLOCK)
               ON SZATENDIMENTO.CODCOLIGADA = SZRESPPACIENTE.CODCOLIGADA
                  AND SZATENDIMENTO.CODPACIENTE = SZRESPPACIENTE.CODPACIENTE
                  AND SZATENDIMENTO.CODATENDIMENTO = SZRESPPACIENTE.CODATENDIMENTO
WHERE  SZATENDIMENTO.CODATENDIMENTO = SZAGENDAMENTO.CODIGOATENDIMENTO
       AND SZATENDIMENTO.DATAENTRADA = SZAGENDAMENTO.DATA
       AND SZATENDIMENTO.CODCOLIGADA = :CODCOLIGADA
       AND SZATENDIMENTO.CODPACIENTE = :CODPACIENTE
       AND SZATENDIMENTO.CODATENDIMENTO = :CODATENDIMENTO 
````

## COMPROVANTE VALOR TOTAL

````
WITH _IDVALORT
     AS (SELECT VALORTOTALHM ,
                _IDVALORT = ROW_NUMBER()
                        OVER (
                          ORDER BY VALORTOTALHM )
         FROM   SZATENDIMENTO (NOLOCK)
                INNER JOIN SZPACIENTE (NOLOCK)
                        ON SZATENDIMENTO.CODCOLIGADA = SZPACIENTE.CODCOLIGADA
                           AND SZATENDIMENTO.CODPACIENTE = SZPACIENTE.CODPACIENTE
                INNER JOIN SZATENDHONORARIO (NOLOCK)
                        ON SZATENDIMENTO.NUMEROCONTA = SZATENDHONORARIO.NUMEROCONTA
                           AND SZATENDIMENTO.SEQUENCIALCONTA = SZATENDHONORARIO.SEQUENCIALCONTA
         WHERE  SZATENDHONORARIO.ESTORNADO IS NULL
                AND SZATENDIMENTO.CODCOLIGADA = :CODCOLIGADA 
                AND SZATENDIMENTO.CODPACIENTE = :CODPACIENTE 
                AND SZATENDIMENTO.CODATENDIMENTO =  :CODATENDIMENTO 
        )
SELECT [TOTAL1] = Max(CASE
                   WHEN _IDVALORT = 1 THEN VALORTOTALHM 
                   ELSE NULL
                 END),
       [TOTAL2] = Max(CASE
                   WHEN _IDVALORT = 2 THEN VALORTOTALHM 
                   ELSE NULL
                 END),
       [TOTAL3] = Max(CASE
                   WHEN _IDVALORT = 3 THEN VALORTOTALHM 
                   ELSE NULL
                 END),
       [TOTAL4] = Max(CASE
                   WHEN _IDVALORT = 4 THEN VALORTOTALHM 
                   ELSE NULL
                 END),
       [TOTAL5] = Max(CASE
                   WHEN _IDVALORT = 5 THEN VALORTOTALHM 
                   ELSE NULL
                 END)
FROM   _IDVALORT 
````

## COMPROVANTE VALOR UNIT√ÅRIO

````
WITH _IDVALOR
     AS (SELECT VALORHM ,
                _IDVALOR = ROW_NUMBER()
                        OVER (
                          ORDER BY VALORHM )
         FROM   SZATENDIMENTO (NOLOCK)
                INNER JOIN SZPACIENTE (NOLOCK)
                        ON SZATENDIMENTO.CODCOLIGADA = SZPACIENTE.CODCOLIGADA
                           AND SZATENDIMENTO.CODPACIENTE = SZPACIENTE.CODPACIENTE
                INNER JOIN SZATENDHONORARIO (NOLOCK)
                        ON SZATENDIMENTO.NUMEROCONTA = SZATENDHONORARIO.NUMEROCONTA
                           AND SZATENDIMENTO.SEQUENCIALCONTA = SZATENDHONORARIO.SEQUENCIALCONTA
         WHERE  SZATENDHONORARIO.ESTORNADO IS NULL
                AND SZATENDIMENTO.CODCOLIGADA = :CODCOLIGADA 
                AND SZATENDIMENTO.CODPACIENTE = :CODPACIENTE 
                AND SZATENDIMENTO.CODATENDIMENTO = :CODATENDIMENTO 
        )
SELECT [VALOR1] = Max(CASE
                   WHEN _IDVALOR = 1 THEN VALORHM 
                   ELSE NULL
                 END),
       [VALOR2] = Max(CASE
                   WHEN _IDVALOR = 2 THEN VALORHM 
                   ELSE NULL
                 END),
       [VALOR3] = Max(CASE
                   WHEN _IDVALOR = 3 THEN VALORHM 
                   ELSE NULL
                 END),
       [VALOR4] = Max(CASE
                   WHEN _IDVALOR = 4 THEN VALORHM 
                   ELSE NULL
                 END),
       [VALOR5] = Max(CASE
                   WHEN _IDVALOR = 5 THEN VALORHM 
                   ELSE NULL
                 END)
FROM   _IDVALOR 


````

## COMPROVANTE QUANTIDADE 

````
WITH _IDUN
     AS (SELECT QUANTIDADEHM,
                _IDUN = ROW_NUMBER()
                        OVER (
                          ORDER BY QUANTIDADEHM)
         FROM   SZATENDIMENTO (NOLOCK)
                INNER JOIN SZPACIENTE (NOLOCK)
                        ON SZATENDIMENTO.CODCOLIGADA = SZPACIENTE.CODCOLIGADA
                           AND SZATENDIMENTO.CODPACIENTE = SZPACIENTE.CODPACIENTE
                INNER JOIN SZATENDHONORARIO (NOLOCK)
                        ON SZATENDIMENTO.NUMEROCONTA = SZATENDHONORARIO.NUMEROCONTA
                           AND SZATENDIMENTO.SEQUENCIALCONTA = SZATENDHONORARIO.SEQUENCIALCONTA
         WHERE  SZATENDHONORARIO.ESTORNADO IS NULL
                AND SZATENDIMENTO.CODCOLIGADA = :CODCOLIGADA 
                AND SZATENDIMENTO.CODPACIENTE =  :CODPACIENTE 
                AND SZATENDIMENTO.CODATENDIMENTO = :CODATENDIMENTO 
        )
SELECT [UN1] = Max(CASE
                   WHEN _IDUN = 1 THEN QUANTIDADEHM
                   ELSE NULL
                 END),
       [UN2] = Max(CASE
                   WHEN _IDUN = 2 THEN QUANTIDADEHM
                   ELSE NULL
                 END),
       [UN3] = Max(CASE
                   WHEN _IDUN = 3 THEN QUANTIDADEHM
                   ELSE NULL
                 END),
       [UN4] = Max(CASE
                   WHEN _IDUN = 4 THEN QUANTIDADEHM
                   ELSE NULL
                 END),
       [UN5] = Max(CASE
                   WHEN _IDUN = 5 THEN QUANTIDADEHM
                   ELSE NULL
                 END)
FROM   _IDUN 
````

## ITENS 

````
WITH _ID_PROC_REAL
     AS (SELECT DISCRIMINACAOHM,
                _ID_PROC_REAL = ROW_NUMBER()
                        OVER (
                          ORDER BY DISCRIMINACAOHM)
         FROM   SZATENDIMENTO (NOLOCK)
                INNER JOIN SZPACIENTE (NOLOCK)
                        ON SZATENDIMENTO.CODCOLIGADA = SZPACIENTE.CODCOLIGADA
                           AND SZATENDIMENTO.CODPACIENTE = SZPACIENTE.CODPACIENTE
                INNER JOIN SZATENDHONORARIO (NOLOCK)
                        ON SZATENDIMENTO.NUMEROCONTA = SZATENDHONORARIO.NUMEROCONTA
                           AND SZATENDIMENTO.SEQUENCIALCONTA = SZATENDHONORARIO.SEQUENCIALCONTA
         WHERE  SZATENDHONORARIO.ESTORNADO IS NULL
                AND SZATENDIMENTO.CODCOLIGADA = :CODCOLIGADA 
                AND SZATENDIMENTO.CODPACIENTE =  :CODPACIENTE 
                AND SZATENDIMENTO.CODATENDIMENTO =  :CODATENDIMENTO 
        )
SELECT [PROC_REAL1] = Max(CASE
                   WHEN _ID_PROC_REAL = 1 THEN DISCRIMINACAOHM
                   ELSE NULL
                 END),
       [PROC_REAL2] = Max(CASE
                   WHEN _ID_PROC_REAL = 2 THEN DISCRIMINACAOHM
                   ELSE NULL
                 END),
       [PROC_REAL3] = Max(CASE
                   WHEN _ID_PROC_REAL = 3 THEN DISCRIMINACAOHM
                   ELSE NULL
                 END),
       [PROC_REAL4] = Max(CASE
                   WHEN _ID_PROC_REAL = 4 THEN DISCRIMINACAOHM
                   ELSE NULL
                 END),
       [PROC_REAL5] = Max(CASE
                   WHEN _ID_PROC_REAL = 5 THEN DISCRIMINACAOHM
                   ELSE NULL
                 END)
FROM   _ID_PROC_REAL 
````